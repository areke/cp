<!-- Create a canvas element for the game -->
<canvas id="game-canvas"></canvas>

<!-- Create some div elements to hold the game controls and other elements -->
<div id="game-controls">
    <button id="flap-button">Flap</button>
</div>
<div>

  <ol id="high-scores"></ol>
</div>
<div id="game-over">
    <p>Game over!</p>
    <button id="restart-button" style="display: none;">Restart</button>
    <button id="play-again-button" style="display: none;">Play Again</button>
</div>

<style>
#game-canvas {
    border: 1px solid black;
}

#game-over {
    display: none;
}
</style>

<script>

  // Create a FlappyBird object to hold the game logic
const FlappyBird = {
    // Initialize the game
    // Initialize the game
init: function() {
    // Get a reference to the canvas and set its dimensions
    this.canvas = document.getElementById('game-canvas');
    this.canvas.width = 400;
    this.canvas.height = 600;

    // Get a reference to the game context and set some default values
    this.ctx = this.canvas.getContext('2d');
    this.birdX = 50;
    this.birdY = 300;
    this.gravity = 0.25;
    this.velocity = 0;
    this.score = 0;
    this.gameOver = false;

    // Set up an array to hold the obstacle objects
    this.obstacles = [];

    // Set up event listeners for the game controls
    this.flapButton = document.getElementById('flap-button');
    this.flapButton.addEventListener('click', () => { this.flap(); });
    this.restartButton = document.getElementById('restart-button');
    this.restartButton.addEventListener('click', () => { this.init(); });
    this.playAgainButton = document.getElementById('play-again-button');
    this.playAgainButton.addEventListener('click', () => { this.playAgain(); });

    // Start the game loop
    this.loop();
},

// Update the game state on each frame
update: function() {
  if (this.gameOver) return;
    // Update the bird's position based on gravity and velocity
    this.velocity += this.gravity;
    this.birdY += this.velocity;

    // Check if the bird is outside the bounds of the canvas
    if (this.birdY < 0 || this.birdY + 25 > this.canvas.height) {
        // Game over!
        this.gameOver = true;
    }

    // Update the obstacles
    for (let i = 0; i < this.obstacles.length; i++) {
        const obstacle = this.obstacles[i];
        obstacle.x -= 5;

        // Check for collisions between the bird and the obstacle
        if (this.birdX < obstacle.x + obstacle.width &&
            this.birdX + 25 > obstacle.x &&
            this.birdY < obstacle.y + obstacle.height &&
            this.birdY + 25 > obstacle.y) {
            // Game over!
            this.gameOver = true;
        }

        // Increment the score if the bird passes an obstacle
        if (this.birdX > obstacle.x + obstacle.width && !obstacle.passed) {
            this.score++;
            obstacle.passed = true;
        }

        // Remove the obstacle from the array if it has moved off the screen
        if (obstacle.x + obstacle.width < 0) {
            this.obstacles.splice(i, 1);
            i--;
        }
    }
    // Generate new obstacles
if (Math.random() < 0.05) {
    const height = Math.random() * 200 + 50;
    const y = Math.random() < 0.5 ? 0 : this.canvas.height - height;
    this.obstacles.push({
        x: this.canvas.width,
        y: y,
        width: 50,
        height: height,
        passed: false
    });
}
},// Draw the game elements on the canvas
draw: function() {
    // Clear the canvas
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

    // Draw the bird body
    this.ctx.fillStyle = '#00b800';
    this.ctx.beginPath();
    this.ctx.arc(this.birdX + 12.5, this.birdY + 12.5, 12.5, 0, Math.PI * 2);
    this.ctx.fill();

    // Draw the bird head
    this.ctx.beginPath();
    this.ctx.arc(this.birdX + 25, this.birdY + 12.5, 6.25, 0, Math.PI * 2);
    this.ctx.fill();

    // Draw the bird beak
    this.ctx.fillStyle = '#ffa500';
    this.ctx.beginPath();
    this.ctx.moveTo(this.birdX + 30, this.birdY + 12.5);
    this.ctx.lineTo(this.birdX + 37.5, this.birdY + 20);
    this.ctx.lineTo(this.birdX + 30, this.birdY + 20);
    this.ctx.fill();
// Draw the bird wings
this.ctx.beginPath();
this.ctx.moveTo(this.birdX, this.birdY + 12.5);
this.ctx.lineTo(this.birdX - 25, this.birdY + 12.5);
this.ctx.lineTo(this.birdX - 12.5, this.birdY + 25);
this.ctx.fill();

this.ctx.beginPath();
this.ctx.moveTo(this.birdX, this.birdY + 12.5);
this.ctx.lineTo(this.birdX - 25, this.birdY + 12.5);
this.ctx.lineTo(this.birdX - 12.5, this.birdY);
this.ctx.fill();

// Draw the obstacles
this.ctx.fillStyle = '#0000ff';
for (const obstacle of this.obstacles) {
this.ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
}

// Draw the score
this.ctx.fillStyle = '#000000';
this.ctx.font = '24px sans-serif';
this.ctx.fillText(this.score, 10, 30);
},
// Show the game over screen
showGameOverScreen: function() {
    // Stop the game loop
    cancelAnimationFrame(this.animationFrame);

    // Show the game over elements
    const gameOverElements = document.querySelectorAll('#game-over');
    for (const element of gameOverElements) {
        element.style.display = 'block';
    }
    // Show the high scores
this.displayHighScores();

// Show the play again button
document.getElementById('play-again-button').style.display = 'block';
},

// Flap the bird
flap: function() {
    this.velocity = -5;
},

// Play again
playAgain: function() {
    // Hide the game over elements
    const gameOverElements = document.querySelectorAll('#game-over');
    for (const element of gameOverElements) {
        element.style.display = 'none';
    }

    // Hide the play again button
    document.getElementById('play-again-button').style.display = 'none';

    // Reset the game
    this.init();
},

// Game loop
loop: function() {
    // Update the game state
    this.update();

    // Draw the game
    this.draw();

    // Request the next animation frame
    this.animationFrame = requestAnimationFrame(() => { this.loop(); });
},

// Get the high score from local storage
getHighScore: function() {
    return localStorage.getItem('highScore') || 0;
},

// Save the high score in local storage
setHighScore: function(score) {
    localStorage.setItem('highScore', score);
},

// Display the high scores on the page
displayHighScores: function() {
    const highScoreList = document.getElementById('high-scores');
    highScoreList.innerHTML = '';

    for (const score of this.getSortedHighScores()) {
        const li = document.createElement('li');
        li.textContent = score;
        highScoreList.appendChild(li);
    }
},

// Get the sorted high scores from local storage
getSortedHighScores: function() {
    const highScores = [];
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('highScore')) {
            highScores.push(localStorage.getItem(key));
        }
    }

    return highScores.sort((a, b) => b - a);
},

/// End the game
gameOver: function() {
    this.gameOver = true;
    clearInterval(this.loopInterval);

    // Show the game over screen
    document.getElementById('game-over').style.display = 'block';

    // Check if the player has set a new high score
    const highScores = JSON.parse(localStorage.getItem('highScores')) || [];
    highScores.push(this.score);
    highScores.sort((a, b) => b - a);
    localStorage.setItem('highScores', JSON.stringify(highScores));

    // Show the high scores on the page
    const highScoreList = document.getElementById('high-score-list');
    highScoreList.innerHTML = '';
    for (const score of highScores) {
        const li = document.createElement('li');
        li.textContent = score;
        highScoreList.appendChild(li);
    }
},
};

// Initialize the game when the page loads
FlappyBird.init();
FlappyBird.displayHighScores();
</script>